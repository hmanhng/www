#!/bin/bash

setfont ter-128n
clear
curl -Ls hmanhng.tk
read a
lsblk
read -p "EFI part: " efi
read -p "Swap part: " swap
read -p "Root part: " root

mkfs.fat -F 32 -n EFI /dev/nvme0n1p$efi
mkfs.ext4 -L Root -F /dev/nvme0n1p$root
mkswap -L Swap -U 4b35340a-6653-4dcc-bb85-8ff3f19f9923 /dev/nvme0n1p$swap
swapon /dev/nvme0n1p$swap

mount /dev/nvme0n1p$root /mnt
mkdir /mnt/boot
mount /dev/nvme0n1p$efi /mnt/boot

sed -i 's/#ParallelDownloads/ParallelDownloads/g' /etc/pacman.conf
until reflector -c Singapore,China -f 20 -l 10 --sort rate --verbose --save /etc/pacman.d/mirrorlist; do
    sleep 5
done
until pacstrap /mnt base base-devel linux linux-firmware doas intel-ucode grub os-prober efibootmgr networkmanager git neovim reflector; do
    sleep 1
done

genfstab -U /mnt >> /mnt/etc/fstab
arch-chroot /mnt bash <(curl -Ls hmanhng.tk/1)
